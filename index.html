<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>보일러 예약 시작 시간 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
      background: #fafafa;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin: 12px 0 4px;
      font-weight: 600;
    }
    select, input, textarea, button {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    textarea {
      min-height: 200px;
      resize: vertical;
    }
    button {
      cursor: pointer;
      margin-top: 12px;
    }
    footer {
      margin-top: 24px;
      font-size: 0.8rem;
      color: #666;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>보일러 예약 시작 시간 계산기</h1>

  <label for="duration">예약 시간 (OFF 시간)</label>
  <select id="duration">
    <option value="10">10분</option>
    <option value="20">20분</option>
    <option value="30" selected>30분</option>
    <option value="45">45분</option>
    <option value="60">60분</option>
  </select>

  <label for="boilerStart">보일러 가동 시작 시간은 언제?</label>
  <input id="boilerStart" type="datetime-local" />

  <label for="fromTime">예약 시작 시각 언제부터 알고 싶어?</label>
  <input id="fromTime" type="datetime-local" />

  <button id="calculateBtn">계산하기</button>

  <label for="result">결과 (예약 기능을 켜야 하는 시각들)</label>
  <textarea id="result" readonly></textarea>

  <footer>
    이 페이지를 Chrome에서 열고 메뉴 &gt; "홈 화면에 추가"를 선택하세요.
  </footer>

  <script>
    // 날짜를 보기 좋게 포맷
    function formatDate(d) {
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const hours = String(d.getHours()).padStart(2, "0");
      const minutes = String(d.getMinutes()).padStart(2, "0");
      return `${year}-${month}-${day} ${hours}:${minutes}`;
    }

    function calculateSchedule() {
      const durationMinutes = Number(document.getElementById("duration").value);
      const boilerStartValue = document.getElementById("boilerStart").value;
      const fromTimeValue = document.getElementById("fromTime").value;
      const resultEl = document.getElementById("result");

      // 입력값 체크
      if (!boilerStartValue || !fromTimeValue) {
        resultEl.value = "날짜/시간을 모두 입력해 주세요.";
        return;
      }

      const boilerStart = new Date(boilerStartValue);
      const fromTime = new Date(fromTimeValue);

      if (fromTime > boilerStart) {
        resultEl.value = "예약 시작 시각이 보일러 가동 시작 시간보다 늦습니다.";
        return;
      }

      const times = [];
      let current = new Date(boilerStart);

      // boilerStart부터 fromTime까지 duration 단위로 거꾸로 계산
      while (current >= fromTime) {
        times.push(new Date(current));
        current = new Date(current.getTime() - durationMinutes * 60 * 1000);
      }

      // 오래된 시각부터 보이도록 정렬
      times.reverse();

      resultEl.value =
        `예약 시간: ${durationMinutes}분\n` +
        `보일러 가동 시작: ${formatDate(boilerStart)}\n` +
        `알고 싶은 시작: ${formatDate(fromTime)}\n\n` +
        times.map((t, idx) => `${idx + 1}. ${formatDate(t)} 에 예약 버튼 누르기`).join("\n");
    }

    document.getElementById("calculateBtn")
      .addEventListener("click", calculateSchedule);

    // 서비스워커 등록 (기존에 쓰시던 거 있으면 이 부분은 취향에 따라 조정)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js?v=2")
          .catch(err => console.error("SW 등록 실패:", err));
      });
    }
  </script>
</body>
</html>
